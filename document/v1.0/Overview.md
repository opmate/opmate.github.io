---
title: 사용자 매뉴얼
description: Overview
---

## 사용자 (User)

사용자는 다음과 같은 정보를 가진다.
> 사용자ID, 비밀번호, 이름, 역할, 휴대전화, 이메일, 설명, 활성상태

### 역할 (Role)

사용자는 다음과 같은 종류의 역할(Role)을 가질 수 있으며, 역할에 따라 수행 가능한 작업의 범위가 달라진다.

| 역할   | 레벨 | 작업 권한                                          |
| ------ | :--: | --------------------------------------------------|
| 관리자 | 0    | 시스템 전체 운영을 위한 각종 변경을 할 수 있다.   |
| 승인자 | 1    | 작업자가 수행하는 작업에 대해 승인 권한을 갖는다. |
| 작업자 | 2    | 태스크를 정의하고 실행하기 위한 권한을 갖는다.    |
| 관람자 | 3    | 조회 위주의 작업만 가능하다.                      |

관리자의 권한 레벨이 가장 높으며, 순서대로 낮은 레벨을 갖는다. 상위 권한 레벨은 하위 권한 레벨이 가능한 작업을 수행할 수 있다.

### 사용자 추가와 변경

사용자 추가 요청은 별도의 인증 과정없이 할 수 있다.
하지만, 요청된 새롭게 추가된 사용자는 관리자가 별도로 **활성화**해야 사용(로그인 등)이 가능해진다.

사용자 정보는 자신 또는 관리자가 변경할 수 있다.
단, 사용자의 활성상태와 역할을 변경하거나, 사용자를 삭제하는 작업은 관리자만 가능하다.

## 사용자 그룹 (User Group)

사용자 그룹은 여러명의 사용자가 모여있는 집합이다.
주로 다수의 사용자들을 동시에 지정하기 위한 용도로 사용되며, 한명의 사용자는 동시에 여러개의 사용자 그룹에 소속될 수 있다.

사용자 그룹의 생성은 작업자 이상의 권한을 가지고 있으면 가능하고, 생성한 사용자가 해당 그룹의 소유자(Owner)가 된다.

하나의 사용자 그룹은 다음과 같은 정보로 구성된다.
> 사용자그룹ID, 설명, 소유자(Owner), 포함 사용자

소유자는 그룹의 각종 속성, 소속 사용자 등을 변경하거나 삭제할 수 있으며, 소유자를 다른 사용자로 변경할 수도 있다.

## 노드 (Node)

노드는 운영 관리의 대상이 되는 서버로서, 에이전트가 설치되어 있는 것을 의미한다.

하나의 노드는 다음과 같은 속성 정보를 가진다.
> 노드ID, GUID, 에이전트버젼, 호스트명, OS종류, 소유자(Owner), 활성상태

### 노드 등록

노드는 별도의 등록 작업없이, 에이전트 후 처음 실행시 *자동으로 등록*된다.

등록된 노드는 고유의 *GUID*가 자동으로 부여되고, *노드ID* 역시 GUID와 유사하게 자동 부여된다.

단, *소유자(Owner)*는 없고 *비활성화* 상태로 유지된다.

### 노드 정보 변경

신규 등록된 노드를 정상적으로 사용하기 위해서는 먼저 **활성화**해야 한다.

자동으로 할당된 **노드ID**는 사용시 너무 길어 불편할 수 있기 때문에, 일반적으로 서버의 호스트명으로 변경한다.
하지만, 호스트명은 중복될 가능성이 있기 때문에, 노드ID도 중복되어 변경이 실패할 수 있다.
이러한 경우, 호스트명과 다른 문자를 조합하여 *고유한 노드ID로 부여*하는 것을 권장한다.

소유자가 지정되지 않은 노드는 작업자 이상의 권한을 가지고 있는 사용자가 변경할 수 있다.
이때, 별도로 지정하지 않는다면 *처음 변경한 사용자*가 해당 노드의 **소유자(Owner)**가 된다.

소유자는 노드의 정보를 변경할 수 있으며, 소유자를 다른 사용자로 변경할 수도 있다.
단, 노드의 삭제와 비활성화는 관리자만 가능하다.

### 노드 비활성화

노드를 비활성화하면 해당 노드가 태스크의 대상 노드(Target Node)로 등록되어 있더라도, 태스크 실행시에 대상에서 제외된다.
특수한 상황으로 인하여, 해당 노드에 어떠한 태스크라도 수행되는 것을 막고 싶을 경우에 유용하다.

## 노드 그룹 (Node Group)

노드 그룹은 여러개의 노드가 모여있는 집합이다. 태스크를 정의할때 다수 노드를 쉽게 추가하기 위해 사용할 수 있으며, 공통 속성을 정의하기 위해 사용할 수 있다. 하나의 노드는 여러개의 노드 그룹에 소속될 수 있다.

노드 그룹을 생성/수정/삭제하기 위해서는 사용자의 권한레벨 1 이상이 필요하다.

하나의 노드 그룹은 다음과 같은 정보로 구성된다.
> 노드그룹ID, 설명, 속성(Attribute), 포함 노드


그룹에 소속된 모든 노드에 공통적으로 적용할 속성(Attribute)을 정의할 수 있다.
예를 들어, 특정 그룹에 TOMCAT_HOME=/home/tomcat 와 같은 속성을 정의하면 소속된 모든 노드의 속성으로 동일하게 적용되며, 스크립트에 해당 속성의 치환 변수(@OPM_ATTR.속성명@)가 사용되었을 경우 정의된 값으로 치환된다.

```
#!/bin/sh

@OPM_ATTR.TOMCAT_HOME@/bin/startup.sh
```

```
#!/bin/sh

/home/tomcat/bin/startup.sh
```

## 태스크 (Task)

태스크는 하나 이상의 노드를 대상으로 동일한 작업(스크립트)을 동시에 실행하기 위한 작업 정의서이다.

태스크의 생성은 작업자 이상의 권한을 가지고 있으면 가능하고, 생성한 사용자가 해당 태스크의 소유자(Owner)가 된다.

소유자는 태스크 정의를 변경하거나 삭제할 수 있으며, 소유자를 다른 사용자로 변경할 수도 있다.

태스크의 주요 구성 정보는 다음과 같다.
> 태스크ID, 스크립트(Script), 대상 노드(Target Node), 스케쥴(Schedule), 실행 방식, 실행 권한, 다음 태스크(Next Task), 소유자(Owner)

### 스크립트 (Script)

스크립트가 기술된 파일(bash 쉘스크립트 파일 등)과 해당 스크립트를 실행할 사용자명(OS의 계정명)을 등록한다.

### 대상 노드 (Target Node)

태스크가 실행되기 원하는 대상 노드를 지정한다. 노드 또는 노드그룹으로 추가할 수 있다.

### 스케쥴 (Schedule)

태스크가 자동으로 실행될 시점을 정의한다. 다음과 같이 주기에 따른 값을 지정할 수 있다.

| 주기 | 지정값                      | 비고              |
| ---- | --------------------------- | ----------------- |
| 매시 | mm분                        | mm : 00 ~ 59      |
| 매일 | hh시 mm분                   | hh : 00 ~ 23      |
| 매주 | d요일 hh시 mm분             | d : 0(일) ~ 6(토) |
| 매월 | DD일 hh시 mm분              | DD : 01 ~ 31      |
| 매년 | MM월 DD일 hh시 mm분         | MM : 01 ~ 12      |
| 한번 | YYYY년 MM월 DD일 hh시 mm분  | YYYY : 2000~9999  |

### 실행 방식

태스크를 실행하는 방식은 다음 3가지이며, 각각 활성화(enable)/비활성화(disable) 할 수 있다.

- **By 스케쥴러**
  - 등록된 스케쥴에 의해서 실행되는 방식
- **By 온디맨드**
  - 사용자가 직접 명령하여 바로 실행되는 방식
- **By 태스크**
  - 다른 태스크가 다음 태스크(Next Task)로 지정하여 실행되는 방식

### 실행 권한

사용자에 의한 온디맨드 실행방식과 다른 태스크에 의한 실행방식은 **실행주체**를 정의해줘야 실행이 가능해진다.
실행주체는 사용자(User), 사용자그룹(User Group), 태스크(Task)가 대상이 될 수 있다.
단, 태스크의 소유자(Owner)는 별도로 부여하지 않아도 실행이 가능하다.

### 다음 태스크 (Next Task)

태스크 실행이 정상적으로 완료(모든 타겟노드의 실행결과가 성공)된 후 자동으로 다른 태스크가 실행되도록 하고 싶을 경우에 지정한다.

단, 호출되는 태스크에서 실행 권한을 부여해줘야 한다.
예를 들어, A태스크가 B태스크를 Next Task로 실행하고자 한다면, B태스크의 권한설정에 A태스크를 실행 가능 태스크로 추가해야 한다.

### 승인(Approval)과 리비젼(Revision)

신규로 추가되거나, 변경된 태스크는 작업본(리비젼 번호 0) 상태로만 존재하고, 실제로 실행되기 위해서는 승인 과정을 거쳐야 한다.

승인은 태스크의 소유자가 검토자 권한을 가진 사용자에게 요청한다.

검토자에 의해 승인된 태스크는 리비젼 번호가 갱신된다. 리비젼 번호는 1부터 시작하며 승인시마다 1씩 증가한다.

태스크의 리비젼 목록을 조회할 수 있으며, 리비젼 번호를 지정하여 해당 리비젼의 태스크 정의를 조회할 수 있다.

## 태스크 인스턴스 (Task Instance)

태스크를 실행하면, 실행마다 새로운 태스크 인스턴스가 생성된다.

하나의 태스크 인스턴스는 전체 태스크에서 유일한 **태스크 인스턴스 번호 (Task Instance No)** 가 부여된다.

### 노드별 상세

태스크 인스턴스 번호와 노드를 지정하면 태스크 인스턴스의 노드별 상세를 확인할 수 있다. 각 노드별로 다음과 같은 속성값을 가지고 있다.

- **진행 상태**
  - 준비 : 노드에 아직 실행 요청을 보내기 전 상태
  - 요청(실행중) : 노드에 실행 요청을 보낸 상태
  - 완료 : 노드가 스크립트를 수행하고 실행 결과를 회신한 상태
  - 실패 : 기타 이유(e.g. 스크립트 다운로드 불가 등)로 스크립트를 실행도 못한 경우
- **실행 결과**
  - N/A
  - 성공 : 스크립트의 실행 결과 코드가 0 인 경우
  - 실패 : 진행 상태가 실패이거나, 스크립트의 실행 결과 코드가 0 이 아닌 경우
- **실행 결과 코드**
  - 스크립트의 최종 종료값
- **표준출력/표준에러**
  - 스크립트 실행 중 발생한 표준출력과 표준에러

### 노드 단위 재실행

이미 생성된 태스크 인스턴스에 대하여, 특정 노드를 지정하여 노드 단위로 재실행할 수 있다.

단, 태스크 인스턴스의 생성 시점 이후에 태스크의 리비젼이 변경되었을 경우 재실행은 불가하다.

## 파일 배포/수집 유틸리티

노드별로 설치되는 에이전트에 포함된 유틸리티이며, 스크립트에 기술하여 실행할 수 있다.

마스터 서버가 아닌, 노드 입장에서 마스터 파일 리파지토리에 업로드하거나, 마스터 파일 리파지토리에서 다운로드하는 방식이다.

리파지토리에 저장된 파일은 일정 기간이 지나면 자동으로 삭제된다.
따라서, 리파지토리는 보관의 용도가 아닌, 대량의 파일 수집과 배포를 위한 임시 공간의 용도로 사용한다.

### 파일 배포

마스터 서버의 파일을 노드에 배포할 경우에 사용한다. 

다음 예제는, 마스터 서버 리파지토리의 /mydir/install-tomcat-1.0.tar.gz 파일을 받아와 노드의 /home/was/install-tomcat-1.0.tar.gz 에 저장하는 명령이다.

`$ opmfget master:/mydir/install-apache.tar.gz /home/web/install-apache.tar.gz`

### 파일 수집

노드의 파일을 마스터 서버로 수집할 경우에 사용한다.

다음 예제는, 노드의 /home/web/apache/conf/server.cfg 파일을 마스터 서버 리파지토리의 /mydir/node1/server.cfg 에 저장하는 명령이다.

`$ opmfput master:/mydir/node1/server.cfg /home/web/apache/server.cfg`

